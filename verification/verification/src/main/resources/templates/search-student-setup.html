<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="common/layout/base">

<div layout:fragment="adminContent" id="scroll">
	<div class="content-header">
		<div class="container-fluid">
			<div class="row mb-2">
				<div class="col-sm-6">
					<h4 class="m-0">Student Basic Information</h4>
				</div>
				<!-- /.col -->
				<div class="col-sm-6">
					<ol class="breadcrumb float-sm-right">
						<li class="breadcrumb-item"><a th:href="@{/admin/home}">Home</a></li>
						<li class="breadcrumb-item active">Student</li>
					</ol>
				</div>
				<!-- /.col -->
			</div>
			<!-- /.row -->
		</div>
	</div>
	<div class="container-fluid">
		<div class="card card-outline card-primary">
			<div class="card-header">
				<h3 class="card-title"></h3>

				<div class="card-tools">
					<button type="button" class="btn btn-tool"
						data-card-widget="collapse">
						<i class="fas fa-minus"></i>
					</button>
					<button type="button" class="btn btn-tool"
						data-card-widget="remove">
						<i class="fas fa-times"></i>
					</button>
				</div>
			</div>
			<!-- /.card-header -->
			<form id="std_general_form">
			 <div class="card-body" style="display: block;">
				<div class="row">
				
					<div class="col-md-6" data-select2-id="29" id="universityId">
						<div class="form-group">
							<label>University<span class="errorMsg">*</span></label> 
							 <select class="form-control"
								id="uniId">
								<option value="">--Select--</option>
								<option th:each="resultMap : ${getUniversityMap}"
									th:value="${resultMap.unID}"
									th:text="${resultMap.universityName}"></option>
							</select> <span class="errorMsg" id="errorMsgUniId"></span>
						</div>
					</div>
					
					
					<div class="col-md-6" data-select2-id="29" id="departmentId">
						<div class="form-group">
							<label>Department<span class="errorMsg">*</span></label> 
							<select class="form-control"
								id="deptId">
								<option value="">--Select--</option>
						    </select>
							 <span
								class="errorMsg" id="errorMsgDeptId"></span>
						</div>
					</div>
					
					<div class="col-md-6" data-select2-id="29" id="batchId">
						<div class="form-group">
							<label>Batch<span class="errorMsg">*</span></label> 
							<select class="form-control"
								id="batch">
								<option value="">--Select--</option>
								<option>1</option>
								<option>2</option>
								<option>3</option>
								<option>4</option>
								<option>5</option>
								<option>6</option>
								<option>7</option>
								<option>8</option>
								<option>9</option>
								<option>10</option>
								<option>11</option>
								<option>12</option>
								<option>13</option>
								<option>14</option>
								<option>15</option>
								<option>16</option>
								<option>17</option>
							 </select>
							 <span
								class="errorMsg" id="errorMsgbatch"></span>
						</div>
					</div>
					
					<div class="col-md-6" data-select2-id="29" id="statusId">
						<div class="form-group">
							<label>Status
						</label> 
							<select class="form-control"
								id="status">
								<option value="">--Select--</option>
								<option value="1">Invalid</option>
							</select>
						</div>
					</div>
					
					<div class="col-md-4" data-select2-id="29" id="studentId" style="display:none;">
						<div class="form-group">
							<label>ID<span class="errorMsg">*</span>
						</label> 
						   <input type="hidden" id="updateId">
							<input
								class="form-control filter" type="text" id="stdID"
								placeholder="Enter ID">
							<span class="errorMsg" id="errorMsgstdID"></span> 
						</div>
					</div>
					
				
					<div class="col-md-4" data-select2-id="29" id="studentNameId" style="display:none;">
						<div class="form-group">
							<label>Name<span class="errorMsg">*</span>
						</label> 
							<input
								class="form-control filter" type="text" id="stdName"
								placeholder="Enter Name"> 
								<span class="errorMsg" id="errorMsgstdName"></span> 
						</div>
					</div>
					
					<div class="col-md-4" data-select2-id="29" id="stdDepartmentId" style="display:none;">
						<div class="form-group">
							<label>ContactNo<span class="errorMsg">*</span>
						</label> 
							<input
								class="form-control filter" type="text" id="stdDepartment"
								placeholder="Enter Department Name"> 
							<span class="errorMsg" id="errorMsgstdDepartment"></span>
						</div>
					</div>
				</div>
			


				<div class="margin">
					
					<div class="btn-group">
						<button style="color: #ffffff;" type="button"
							class="btn btn-block bg-gradient-info btn-sm" id='btnSave'>
							<i class="fa fa-search" aria-hidden="true"></i> Save
						</button>
						<button style="color: #ffffff;display:none;" type="button"
							class="btn btn-block bg-gradient-info btn-sm" id='btnUpdate'>
							<i class="fa fa-search" aria-hidden="true"></i> Update
						</button>
					</div>
					<div class="btn-group">
						<button style="color: #ffffff;" type="button"
							class="btn btn-block bg-gradient-warning btn-sm"
							id='btnReset'>
							<i class="fas fa-sync"></i> Reset
						</button>
						<button style="color: #ffffff;display:none;" type="button"
							class="btn btn-block bg-gradient-warning btn-sm" id='btnReset2'>
							<i class="fas fa-sync" aria-hidden="true"></i> Reset
						</button>
					</div>
					
					
					
					
					
					
                  </div>
			</div>
			</form>
		</div>
		
		<div class="card card-default">
			<div class="card-header">
				<h3 class="card-title"></h3>

				<div class="card-tools">
					<button type="button" class="btn btn-tool"
						data-card-widget="collapse">
						<i class="fas fa-minus"></i>
					</button>
					<button type="button" class="btn btn-tool"
						data-card-widget="remove">
						<i class="fas fa-times"></i>
					</button>
				</div>
			</div>
			
			<!-- /.card-header -->
			<div class="card-body" style="display: block;">
				<table class="table table-bordered" id="tbl-searchStd">
					<thead>
						<tr style="text-align:center;">
							<th style="width: 10px">RollNo</th>
							<th>Name</th>
							<th>ContactNo</th>
							<th>Status</th>
							 <th style="width: 100px">Action</th>  
						</tr>
					</thead>
					<tbody style="text-align:center;">
				   </tbody>
				</table>
			</div>
		</div>		
	</div>
</div>

<div layout:fragment="script">


	<script type="text/javascript">
		$(document)
				.ready(
						function() {
				
							 $("#nav-itemStudent").addClass("active menu-is-opening menu-open");
							 $("#nav-linksearchStudent").addClass("active");
							
			                   $("#btnSave")
									.click(
											function() {
												
											if (dataValidation()) {
												loadStudentFilteringTabel();
                                              }

										});
			                   
			                   function loadStudentFilteringTabel() {
			                	   
			                	   var groupFilterTable = $('#tbl-searchStd');
			                	 
			                	   var stdBasicInfo = {};
									stdBasicInfo.uniId = $("#uniId").val();
									stdBasicInfo.deptId = $("#deptId").val();
									stdBasicInfo.batch = $("#batch").val();
									stdBasicInfo.status = $("#status").val();
			                     
			                       $.ajax({
			                           type: 'POST',
			                           contentType: 'application/json',
			                           url: "/ajax/filteringStudentGroup",
			                           data: JSON.stringify(stdBasicInfo),
			                           dataType: 'json',
			                           success: function (data) {
			                        	   groupFilterTable.dataTable({
			                                   paging: true,
			                                   searching: true,
			                                   destroy: true,
			                                   data: data,
			                                   columns: [{
		                                           "data": "stdId"
		                                        },{
		                                           "data": "stdName"
		                                       }, {
		                                           "data": "phoneNo"
		                                       },{
		                                           "data": "status",
		                                           "render": function (data, type, row) {
		                                               var getStatus = '';
		                                             
		                                               if (data == '1') {
		                                                   getStatus = '<span  style="padding:6px;border-radius:5px;background:red;color:#ffffff;">In Valid</span>';
		                                             }else{
		                                        	   getStatus = '<span  style="padding:6px;border-radius:5px;background:green;color:#ffffff;">Valid</span>';
		                                           }
		                                               return getStatus;
		                                           }

		                                       },{
													"className" : "dt-btn",
													"render" : function() {
														return '<div class="btn-group btn-group-sm"> <a href="#" class="btn btn-info" id="editUnID"><i class="fas fa-user-edit"></i></a><a href="#" class="btn btn-danger" id="deleteUnID"><i class="fas fa-trash"></i></a></div>';
													}
												}],
			                                     "fnCreatedRow": function (nRow, aData, iDataIndex) {
			                                       $('td:eq(1)', nRow).attr("data-id", aData.id);
			                                   }
			                               });
			                           },
			                           error: function (e) {
			                        	   showCustomAlert('F','dddddddddddddddddddddddddddddddd!!');
			                           }
			                       });

			                   }

         
							function dataValidation() {

								var status = true;
								
								if ($("#uniId").val() == "") {
									status = false;
									$("#errorMsgUniId").text(
											"Required Field!!");
									$("#uniId")
											.css('border', '1px solid red');
									$("#uniId").focus();
									return status;
								} else {
									$("#errorMsgUniId").text("");
									$("#uniId").css('border',
											'1px solid #CED4DA');
								}

								
								if ($("#deptId").val() == "") {
									status = false;
									$("#errorMsgDeptId").text(
											"Required Field!!");
									$("#deptId")
											.css('border', '1px solid red');
									$("#deptId").focus();
									return status;
								} else {
									$("#errorMsgDeptId").text("");
									$("#deptId").css('border',
											'1px solid #CED4DA');
								}
								
							
								if ($("#batch").val() == "") {
									status = false;
									$("#errorMsgbatch").text(
											"Required Field!!");
									$("#batch")
											.css('border', '1px solid red');
									$("#batch").focus();
									return status;
								} else {
									$("#errorMsgbatch").text("");
									$("#batch").css('border',
											'1px solid #CED4DA');
								}
								
								return status;
							}

							$("#btnReset").click(function() {
								clrFrom();
								loadStudentFilteringTabel();
							});
							
							
							
							function clrFrom(){
								 $("#uniId").val('');
								 $("#status").val('');
								  var deptId = $('#deptId');
									deptId.empty();
									deptId.append($('<option/>', {
										value : "",
										text : "--Select--"
									}));
									$("#errorMsgDeptId").text("");
									$("#deptId").css('border',
											'1px solid #CED4DA');
									$("#errorMsgUniId").text("");
									$("#uniId").css('border',
											'1px solid #CED4DA');
									$("#errorMsgFile").text("");
									$("#batch").val('');
								    $("#errorMsgbatch").text("");
									$("#batch").css('border',
											'1px solid #CED4DA');
									
							}
							
							

							$(document).on("change", "#uniId", function(e) {
								
								var uniId = $("#uniId option:selected").val();
								
								if(uniId==''){
									 var deptId = $('#deptId');
										deptId.empty();
										deptId.append($('<option/>', {
											value : "",
											text : "--Select--"
										}));
									
								}else{
									
									$.get("/ajax/get-dept-list?uniId=" + uniId,
											
											function(data, status) {
												var deptId = $('#deptId');
												deptId.empty();
												deptId.append($('<option/>', {
													value : "",
													text : "--Select--"
												}));
												$.each(data, function(index, dtoName) {
													deptId.append($('<option/>', {
														value : dtoName.deptId,
														text : dtoName.deptName
													}));

												});

											});
									
								}

								
							});
							
							
							$('#tbl-searchStd tbody').on('click', '#editUnID', function () {
								var curRow = $(this).closest('tr');
						        var stdtId = curRow.find('td:eq(1)').attr("data-id");
						        var stdID = curRow.find('td:eq(0)').text();
						        var stdName = curRow.find('td:eq(1)').text();
						        var stdDepartment = curRow.find('td:eq(2)').text();
						        $("#updateId").val(stdtId);
						        $("#stdID").val(stdID);
						        $("#stdName").val(stdName);
						        $("#stdDepartment").val(stdDepartment);
						        //
						        
								$("#statusId").css('display','none');
								$("#universityId").css('display','none');
								$("#batchId").css('display','none');
								$("#departmentId").css('display','none');
								//
								$("#studentId").css('display','block');
								$("#studentNameId").css('display','block');
								$("#stdDepartmentId").css('display','block');
								
								$("#btnSave").css('display','none');
								$("#btnReset").css('display','none');
								$("#btnUpdate").css('display','block');
								$("#btnReset2").css('display','block');
								
								
							
								 $("#errorMsgstdID").text('');
								 $("#errorMsgstdName").text('');
								 $("#errorMsgstdDepartment").text('');
							   
						    });
							//delete function
							
							
							$('#tbl-searchStd tbody').on('click', '#deleteUnID', function () {
							        var curRow = $(this).closest('tr');
							        var stdtId = curRow.find('td:eq(1)').attr("data-id");
							      
							        if (stdtId != '') {
							        	
							            $.confirm({
							            	type: 'orange',
							            	title: '<i class="fa fa-exclamation-triangle" aria-hidden="true" style="color:orange;"></i> '+'Confirm!',
							                content: 'Are your sure?',
							                buttons: {
							                    ok: function () {
							                        $.ajax({
							                            url: "/ajax/deleteStudent?stdtId=" + stdtId,
							                            type: 'GET',
							                            dataType: 'json',
							                            success: function (data) {
							                           
							                            if(data.msgCode=='200'){
							                            	$.confirm({
						                     		         	type: 'green',
						                     		         	title: '<i class="fas fa-check-circle" aria-hidden="true" style="color:#51D88A;"></i> '+'Success!!',
						                     		             content: 'Delete student Information successfully.',
						                     		   
						                     		             buttons: {
						                     		                 ok: function () {
						                     		                   
						                     		                 }
						                     		                 
						                     		             }
						                     		         });
							                            	loadStudentFilteringTabel();
														}
							                              
							                            },
							                            error: function (xhr, status, error) {
							                                showAlertByType('Something Wrong!', "F");
							                            }
							                        });
							                    },
							                    cancel: function () {

							                    }
							                }
							            });
							        }
							    });
 
							
							//end function
							
                            
                            function dataValidationStdUpdate() {

								var status = true;
								
								if ($("#stdRollNo").val() == "") {
									status = false;
									$("#errorMsgStdRollNo").text(
											"Required Field!!");
									$("#stdRollNo")
											.css('border', '1px solid red');
									$("#stdRollNo").focus();
									return status;
								} else {
									$("#errorMsgStdRollNo").text("");
									$("#uniId").css('border',
											'1px solid #CED4DA');
								}

								
								if ($("#name").val() == "") {
									status = false;
									$("#errorMsgName").text(
											"Required Field!!");
									$("#name")
											.css('border', '1px solid red');
									$("#name").focus();
									return status;
								} else {
									$("#errorMsgName").text("");
									$("#name").css('border',
											'1px solid #CED4DA');
								}
								
							
								if ($("#contactNo").val() == "") {
									status = false;
									$("#errorMsgContactNo").text(
											"Required Field!!");
									$("#contactNo")
											.css('border', '1px solid red');
									$("#contactNo").focus();
									return status;
								} else {
									$("#errorMsgContactNo").text("");
									$("#contactNo").css('border',
											'1px solid #CED4DA');
								}
								
								return status;
							
							}
							
							
                            $("#btnReset2").click(function() {
                            	 defaultFromMode();
							});
                            
                            function defaultFromMode(){
                            	
                            	$("#statusId").css('display','block');
								$("#universityId").css('display','block');
								$("#batchId").css('display','block');
								$("#departmentId").css('display','block');
								//
								$("#studentId").css('display','none');
								$("#studentNameId").css('display','none');
								$("#stdDepartmentId").css('display','none');
								
								$("#btnSave").css('display','block');
								$("#btnReset").css('display','block');
								$("#btnUpdate").css('display','none');
								$("#btnReset2").css('display','none');
                            }
                            
                            $("#btnUpdate").click(function() {
                            	
                            	if (dataValidationUpdateStd()) {

									var uniList = {};
									uniList.stdID = $("#stdID").val();
									uniList.stdName = $("#stdName").val();
									uniList.stdDepartment = $("#stdDepartment").val();
									uniList.updateId = $("#updateId").val();
									
									$
									.ajax({
										type : "POST",
										contentType : "application/json",
										url : "/ajax/updateStudent",
										data : JSON
												.stringify(uniList),
										timeout : 100000,
										async : true,
										dataType : 'json',
										success : function(data) {
											if(data.msgCode=='200'){
											   $.confirm({
			                     		         	type: 'green',
			                     		         	title: '<i class="fas fa-check-circle" aria-hidden="true" style="color:#51D88A;"></i> '+'Success!!',
			                     		             content: 'Save Student Information Successfully!!',
			                     		   
			                     		             buttons: {
			                     		                 ok: function () {
			                     		                   
			                     		                 }
			                     		                 
			                     		             }
			                     		         });
												loadStudentFilteringTabel();
												defaultFromMode();
											}
										
										},
										error : function(xhr,status,error) {
											showCustomAlert('D',"Sorry,Something wrong.Please contact with IT Team!!");
										}
									});
								}
							
                            });
							
							
							
                        	function dataValidationUpdateStd() {

								var status = true;
								
								if ($("#stdID").val() == "") {
									status = false;
									$("#errorMsgstdID").text(
											"Required Field!!");
									$("#stdID").css('border',
											'1px solid red');
									$("#stdID").focus();
									return status;
                                } else {
									$("#errorMsgstdID").text("");
									$("#stdID").css('border',
											'1px solid #CED4DA');
								}
								
								if ($("#stdName").val() == "") {
									status = false;
									$("#errorMsgstdName").text(
											"Required Field!!");
									$("#stdName").css('border',
											'1px solid red');
									$("#stdName").focus();
									return status;
                                } else {
									$("#errorMsgstdName").text("");
									$("#stdName").css('border',
											'1px solid #CED4DA');
								}
								
								if ($("#stdDepartment").val() == "") {
									status = false;
									$("#errorMsgstdDepartment").text(
											"Required Field!!");
									$("#stdDepartment").css('border',
											'1px solid red');
									$("#stdDepartment").focus();
									return status;
                                } else {
									$("#errorMsgstdDepartment").text("");
									$("#stdDepartment").css('border',
											'1px solid #CED4DA');
								}
								
							       return status;
							}
							
							
							
							
							
							
				
						});
	</script>


</div>

<div layout:fragment="css">
	<style>
.errorMsg {
	color: red;
	font-size: 13px;
}

table.dataTable thead th, table.dataTable thead td {
	border-bottom: 1px solid #DEE2E6;
}

table.dataTable.no-footer {
	border-bottom: 1px solid #DEE2E6;
}
</style>
</div>